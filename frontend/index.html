<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market News Radar</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <h1 class="header-title">üì° Market News Radar</h1>
            
            <div class="header-controls">
                <!-- Search Input -->
                <div class="control-group">
                    <label for="search-input" class="sr-only">Search</label>
                    <input 
                        type="text" 
                        id="search-input" 
                        class="search-input" 
                        placeholder="Search articles..."
                        aria-label="Search articles"
                    >
                </div>
                
                <!-- Ticker Filter -->
                <div class="control-group">
                    <label for="ticker-filter-select" class="control-label">Ticker:</label>
                    <select id="ticker-filter-select" class="score-select" aria-label="Ticker filter">
                        <option value="">All Tickers</option>
                        <!-- Populated dynamically from tickers list -->
                    </select>
                </div>
                
                <!-- Min Score Filter -->
                <div class="control-group">
                    <label for="min-score-select" class="control-label">Min Score:</label>
                    <select id="min-score-select" class="score-select" aria-label="Minimum score filter">
                        <option value="">All</option>
                        <option value="1">1+</option>
                        <option value="2">2+</option>
                        <option value="3">3+</option>
                        <option value="5">5+</option>
                        <option value="10">10+</option>
                    </select>
                </div>
                
                <!-- Refresh Button -->
                <button id="refresh-btn" class="btn btn-primary" aria-label="Refresh now">
                    üîÑ Refresh Now
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Left Sidebar: Settings Panel -->
        <aside class="settings-panel">
            <h2 class="panel-title">‚öôÔ∏è Settings</h2>
            
            <!-- General Settings -->
            <section class="settings-section">
                <h3 class="section-title">General</h3>
                
                <!-- Admin Token -->
                <div class="form-group" style="margin-bottom: 20px; padding: 10px; background: rgba(255, 255, 255, 0.03); border-radius: 6px;">
                    <label for="admin-token" style="display: flex; align-items: center; gap: 5px;">
                        üîê Admin Token
                        <span style="font-size: 0.85em; opacity: 0.7;">(optional)</span>
                    </label>
                    <input 
                        type="password" 
                        id="admin-token" 
                        class="form-input"
                        placeholder="Leave empty if not required"
                        style="margin-top: 5px;"
                    >
                    <small style="display: block; margin-top: 5px; opacity: 0.7; font-size: 0.85em;">
                        Required for modifying feeds, tickers, keywords, and settings if server has ADMIN_TOKEN set.
                    </small>
                </div>
                
                <form id="general-settings-form" class="settings-form">
                    <div class="form-group">
                        <label for="refresh-interval">Refresh Interval (seconds):</label>
                        <input 
                            type="number" 
                            id="refresh-interval" 
                            name="refresh_interval"
                            min="10" 
                            value="300"
                            class="form-input"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="min-score-default">Min Score to Show:</label>
                        <input 
                            type="number" 
                            id="min-score-default" 
                            name="min_score"
                            min="0" 
                            value="1"
                            class="form-input"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="strong-words">Strong Words (comma-separated):</label>
                        <textarea 
                            id="strong-words" 
                            name="strong_words"
                            class="form-textarea"
                            rows="3"
                            placeholder="breaking,exclusive,surge,crash"
                            required
                        ></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-secondary btn-block">
                        Save Settings
                    </button>
                </form>
            </section>

            <!-- RSS Feeds -->
            <section class="settings-section">
                <h3 class="section-title">üì∞ RSS Feeds</h3>
                <ul id="feeds-list" class="item-list" role="list">
                    <!-- Feeds will be loaded here -->
                </ul>
                <form id="add-feed-form" class="add-form">
                    <input 
                        type="text" 
                        id="feed-name" 
                        placeholder="Feed name"
                        class="form-input"
                        required
                    >
                    <input 
                        type="url" 
                        id="feed-url" 
                        placeholder="RSS URL"
                        class="form-input"
                        required
                    >
                    <button type="submit" class="btn btn-small btn-secondary">
                        + Add Feed
                    </button>
                </form>
            </section>

            <!-- Tickers -->
            <section class="settings-section">
                <h3 class="section-title">üìà Tickers</h3>
                <ul id="tickers-list" class="item-list" role="list">
                    <!-- Tickers will be loaded here -->
                </ul>
                <form id="add-ticker-form" class="add-form">
                    <div class="autocomplete-container">
                        <input 
                            type="text" 
                            id="ticker-symbol" 
                            placeholder="Symbol or company name..."
                            class="form-input"
                            maxlength="50"
                            required
                            autocomplete="off"
                        >
                        <div id="ticker-autocomplete" class="autocomplete-dropdown" role="listbox" hidden></div>
                    </div>
                    <input 
                        type="text" 
                        id="ticker-companies" 
                        placeholder="Company names (e.g., apple,apple inc)"
                        class="form-input"
                        maxlength="500"
                        title="Comma-separated company name aliases"
                    >
                    <button type="submit" class="btn btn-small btn-secondary">
                        + Add Ticker
                    </button>
                </form>
            </section>

            <!-- Keywords -->
            <section class="settings-section">
                <h3 class="section-title">üîë Keywords</h3>
                <ul id="keywords-list" class="item-list tags-list" role="list">
                    <!-- Keywords will be loaded here -->
                </ul>
                <form id="add-keyword-form" class="add-form">
                    <input 
                        type="text" 
                        id="keyword-word" 
                        placeholder="Keyword"
                        class="form-input"
                        maxlength="50"
                        required
                    >
                    <button type="submit" class="btn btn-small btn-secondary">
                        + Add Keyword
                    </button>
                </form>
            </section>

            <!-- Maintenance -->
            <section class="settings-section">
                <h3 class="section-title">üóëÔ∏è Maintenance</h3>
                <button id="prune-btn" class="btn btn-danger btn-block">
                    Delete Articles Older Than 7 Days
                </button>
            </section>
        </aside>

        <!-- Right Content: Results -->
        <div class="results-container">
            <!-- Meta Information -->
            <div class="results-meta">
                <div class="meta-status">
                    <span id="connection-status" class="status-badge status-connecting">
                        ‚ö° Connecting...
                    </span>
                    <span id="auto-refresh-status" class="status-text">
                        Auto-refresh: 30s
                    </span>
                </div>
                <div class="meta-info">
                    <span id="results-count">Loading...</span>
                    <button id="info-btn" class="btn-icon" title="How scoring works" aria-label="Information">‚ÑπÔ∏è</button>
                </div>
            </div>
            
            <!-- Info Modal -->
            <div id="info-modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modal-title">üìä How It Works</h2>
                        <button class="modal-close" aria-label="Close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <section class="info-section">
                            <h3>üéØ Relevance Score</h3>
                            <p>Each article gets a score based on:</p>
                            <ul>
                                <li><strong>Tickers:</strong> +2 points per matched ticker (AAPL, TSLA, etc.)</li>
                                <li><strong>Keywords:</strong> +1 point per keyword hit (earnings, IPO, etc.)</li>
                                <li><strong>Strong words:</strong> +1 bonus if breaking, exclusive, surge, crash, etc.</li>
                            </ul>
                            <p class="example">
                                <strong>Example:</strong> Article mentions AAPL + MSFT (4 pts) + "earnings" 2 times (2 pts) + contains "breaking" (1 pt) = <strong>Score: 7</strong>
                            </p>
                        </section>
                        
                        <section class="info-section">
                            <h3>üòä Sentiment Analysis</h3>
                            <p>Shows the emotional tone of the article:</p>
                            <ul>
                                <li><strong class="sentiment-pos">üòä Positive (green):</strong> Score &gt; 0.1 - Bullish, optimistic news</li>
                                <li><strong class="sentiment-neutral">üòê Neutral (gray):</strong> Score -0.1 to 0.1 - Factual reporting</li>
                                <li><strong class="sentiment-neg">üòü Negative (red):</strong> Score &lt; -0.1 - Bearish, concerning news</li>
                            </ul>
                            <p class="note">Uses VADER sentiment analysis on title + summary. Range: -1 (very negative) to +1 (very positive).</p>
                        </section>
                        
                        <section class="info-section">
                            <h3>üìà Ticker Detection</h3>
                            <p>Articles are matched to tickers in two ways:</p>
                            <ul>
                                <li><strong>Symbol matching:</strong> Detects ticker symbols like $AAPL, (TSLA), etc.</li>
                                <li><strong>Company name matching:</strong> Matches company names you configure (e.g., "apple" ‚Üí AAPL)</li>
                            </ul>
                            <p class="note">üí° Tip: When adding tickers, include company name aliases (comma-separated) for better detection!</p>
                            <p class="example">Example: Add ticker "NVDA" with names "nvidia,nvidia corporation" to catch all mentions.</p>
                        </section>
                    </div>
                </div>
            </div>

            <!-- Helpful Tip Banner -->
            <div id="tip-banner" class="tip-banner">
                <span>üí° <strong>Tip:</strong> Click "üîÑ Refresh Now" to fetch articles and see ticker badges appear!</span>
                <button onclick="closeTipBanner()" aria-label="Close tip">&times;</button>
            </div>

            <!-- Article Cards Container -->
            <div id="articles-container" class="articles-container" role="feed" aria-live="polite">
                <!-- Loading indicator -->
                <div class="loading-indicator">
                    <div class="spinner"></div>
                    <p>Loading articles...</p>
                </div>
            </div>

            <!-- Load More / Infinite Scroll Trigger -->
            <div id="load-more-trigger" class="load-more-trigger">
                <div class="spinner"></div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <span id="toast-message"></span>
    </div>

    <!-- Scripts -->
    <script src="/app.js"></script>
</body>
</html>
